<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bird Store</title>
    <script src="Store.js"></script>
    <script src="demo.js"></script>
    <script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
    <style>
        table, td {
            border: 1px solid black;
            background: azure;
        }
        table {
            margin: 5px;
        }
    </style>
</head>
<body>
<form id="addBird" onsubmit="return false">
    Bird name:<input id="birdName" type="text"><br>
    Price: <input id="price" type="text"><br>
    Amount: <input id="addCount" type="text"><br>
    <button id="submitBird" onclick="addBird()">Add bird</button>
</form>
<table id="birds">
    <tr>
        <td>Name:</td>
        <td>Price:</td>
        <td>Amount:</td>
    </tr>
</table>
<form id="sellBird" onsubmit="return false">
    Bird name:<input id="birdToSell" type="text"><br>
    Amount: <input id="amountToSell" type="text"><br>
    Client: <input id="clientToSell" type="text"><br>
    <button id="sellButton" onclick="sellBird()">Sell bird</button>
</form>
<table id="clients">
    <tr>
        <td>Name:</td>
        <td>Number of trades:</td>
    </tr>
</table>
<table id="trades">
    <tr>
        <td>Bird:</td>
        <td>Amount:</td>
        <td>To client:</td>
    </tr>
</table>
<script>
    function test() {
        printAvailableBirds(store);
    }

    function addBird() {
        const name = document.getElementById("birdName").value;
        const price = document.getElementById("price").value;
        const count = document.getElementById("addCount").value;
        const bird = store.add(name, parseInt(count), parseFloat(price));
        addBirdToTable(bird);
    }

    function sellBird() {
        const birdName = document.getElementById("birdToSell").value;
        const clientName = document.getElementById("clientToSell").value;
        const count = document.getElementById("amountToSell").value;
        const trade = store.sell(birdName, parseInt(count), clientName);
        refreshBirdsTable();
        refreshClientsTable();
        addTransaction(trade);
    }

    function addBirdToTable(bird) {
        const birdsTable = document.getElementById("birds");
        const tbody = birdsTable.children[0];
        const row = document.createElement("tr");
        row.id = bird.name;
        for (const prop in bird) {
            if (bird.hasOwnProperty(prop)) {
                const cell = document.createElement("td");
                cell.appendChild(document.createTextNode(bird[prop]));
                row.appendChild(cell);
            }
        }
        tbody.appendChild(row);
    }

    function addTransaction(trade) {
        if (trade !== undefined) {
            const tradesTable = document.getElementById("trades");
            const tbody = tradesTable.children[0];
            const row = document.createElement("tr");
            for (const prop in trade) {
                if (trade.hasOwnProperty(prop)) {
                    const cell = document.createElement("td");
                    cell.appendChild(document.createTextNode(trade[prop]));
                    row.appendChild(cell);
                }
            }
            tbody.appendChild(row);
        }
    }

    function refreshBirdsTable() {
        const birdsTable = document.getElementById("birds");
        let tbody = birdsTable.children[0];
        for (var i = tbody.childNodes.length - 1; i > 0; i--) {
            if (tbody.childNodes[i] !== undefined && tbody.childNodes[i].id !== "") {
                tbody.removeChild(tbody.childNodes[i]);
            }
        }
        for (const bird of store.getBirds()) {
            const row = document.createElement("tr");
            row.id = bird.name;
            for (const prop in bird) {
                if (bird.hasOwnProperty(prop)) {
                    const cell = document.createElement("td");
                    cell.appendChild(document.createTextNode(bird[prop]));
                    row.appendChild(cell);
                }
            }
            tbody.appendChild(row);
        }
    }

    function refreshClientsTable() {
        const clientsTable = document.getElementById("clients");
        let tbody = clientsTable.children[0];
        for (var i = tbody.childNodes.length - 1; i > 0; i--) {
            if (tbody.childNodes[i] !== undefined && tbody.childNodes[i].id !== "") {
                tbody.removeChild(tbody.childNodes[i]);
            }
        }
        for (const client of store.getClients()) {
            const row = document.createElement("tr");
            row.id = client.name;
            for (const prop in client) {
                if (client.hasOwnProperty(prop)) {
                    const cell = document.createElement("td");
                    const value = client[prop];
                    cell.appendChild(document.createTextNode(typeof value === "string" ? value : value.length));
                    row.appendChild(cell);
                }
            }
            tbody.appendChild(row);
        }
    }

    var store = new Store();
    demo(store);
    refreshBirdsTable();
</script>
</body>
</html>